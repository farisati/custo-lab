;/*FB_PKG_DELIM*/

__d("BootloaderEventsPerf",["invariant","Bootloader","BootloaderEvents","ResourceTimingStore","objectEntries","objectValues"],(function(a,b,c,d,e,f,g,h){var i=["start_time","resources","durations"],j={total_count:0,total_bytes:0,downloaded_count:0,downloaded_bytes:0,cached_count:0,cached_bytes:0,inlined_count:0,inlined_bytes:0,duration:0,missing_count:0};function k(a,b,c){return Math.max(0,(c!=null?c:0)-Math.max(a,b!=null?b:0))}function l(){return{blocking:babelHelpers["extends"]({},j),nonblocking:babelHelpers["extends"]({},j),"default":babelHelpers["extends"]({},j)}}function m(a,b,c){var e,f;if(c==null)e=0,f="downloaded";else if(c[1])e=c[0].length,f="inlined";else{c=d("ResourceTimingStore").getEntryForURL(c[0]);c?(e=c.encodedBodySize,f=c.transferSize===0?"cached":"downloaded"):(e=0,f="downloaded",a.missing_count++)}a.total_count++;a.total_bytes+=e;if(!b)return;a.duration=Math.max(a.duration,b);switch(f){case"downloaded":a.downloaded_count++;a.downloaded_bytes+=e;break;case"inlined":a.inlined_count++;a.inlined_bytes+=e;break;case"cached":a.cached_count++;a.cached_bytes+=e;break}}function n(a,b,d,e,f){var g=c("Bootloader").getResourceState(b);m(a,k(d,g.loadStart,g.loadEnd),e);g.loadError!=null&&f.add(b)}function o(a,b,d,e){var f=l();for(a of c("objectEntries")(a)){var g=a[0],i=a[1];for(i of i){var j=i[0],k=i[1],m=void 0,o=void 0;switch(k.type){case"async":o=null;m=d;break;case"js":case"css":o=[k.src,k.d===1];m=f;break;default:k,h(0,3721)}n(m[g],j,b,o,e)}}return f}function p(a,b){var e={unpredicted:d("BootloaderEvents").newResourceMapSet(),ef:d("BootloaderEvents").newResourceMapSet(),overpredicted:d("BootloaderEvents").newResourceMapSet()};for(var f of c("objectEntries")(b)){var g=f[0],h=f[1];for(h of h.entries()){var i=h[0],j=h[1];a[g].has(i)?e.ef[g].set(i,j):e.overpredicted[g].set(i,j)}}for(i of c("objectEntries")(a)){j=i[0];h=i[1];for(g of h.entries()){f=g[0];a=g[1];b[j].has(f)||e.unpredicted[j].set(f,a)}}return e}function a(a){var b=a.efData,c=a.rsrcs,d=a.startTime,e=new Set(),f;if(b){var g=p(c,b.tierOne);f=g.unpredicted;g={ef:o(g.ef,b.fetchRsrcsStart,l(),e),overpredicted:o(g.overpredicted,b.fetchRsrcsStart,l(),e)};b={ef_fetch_predictions:b.fetchPredictionsEnd-b.fetchPredictionsStart,ef_fetch_start_wait:b.fetchPredictionsEnd-b.fetchRsrcsStart,ef_head_start:d-b.fetchRsrcsStart}}else f=c,g={},b={};c=babelHelpers["extends"]({unpredicted:o(f,d,l(),e)},g);return{source:a.source,source_detail:a.sourceDetail,is_first_identical:a.isFirstIdentical,timeslice_context:(f=a.timesliceContext)==null?void 0:f.name,start_time:d,err_count:e.size,resources:c,durations:babelHelpers["extends"]({jsmods_wait:a.jsmodsStart-d,jsmods:a.jsmodsEnd-a.jsmodsStart,jsmods_done_wait:a.jsmodsEnd-d,download_done_wait:a.logTime-d},b),payloadStats:a.payloadStats}}function b(a){var b=a.startTime,e=0,f=0,g=0,h=0;for(var i of a.components){var j=c("Bootloader").getComponentTiming(i),n=j.tierTwoStart,p=j.tierTwoEnd,q=j.tierThreeStart;j=j.tierThreeEnd;e=Math.max(e,k(b,n,p));f=Math.max(f,k(b,b,p));g=Math.max(g,k(b,q,j));h=Math.max(h,k(b,b,j))}n=new Set();p=l();q=o(a.tierOne,b,p,n);j=o(a.tierTwo,b,p,n);i=o(a.tierThree,b,p,n);var r=p.blocking.downloaded_count!=0,s=l(),t=d("BootloaderEvents").newResourceMapSet(),u=new Set();for(var v of[a.tierOne,a.tierTwo,a.tierThree])for(var w of c("objectValues")(v))for(var x of w.keys())u.add(x);x=0;w=0;v=0;for(var y of a.beRequests.values()){x+=k(b,b,y.requestStart);w+=y.serverGenTime;v+=y.jsmodsEnd-y.jsmodsStart;m(s[r?"blocking":"nonblocking"],y.responseStart-y.requestStart,[y.uri,!1]);for(var z of c("objectEntries")(y.rsrcs)){var A=z[0],B=z[1];for(B of B){var C=B[0],D=B[1];u.has(C)||t[A].set(C,D)}}}C=o(t,b,p,n);return{ref:a.ref,components:a.components,timeslice_context:(D=a.timesliceContext)==null?void 0:D.name,start_time:b,err_count:n.size,resources:{t1:q,t2:j,t3:i,be:s,unpredicted:C,async:p},durations:{fetch_start_wait:a.fetchStartTime-b,be_start_wait:x,be_server_gen:w,be_jsmods:v,callback_wait:a.callbackStart-b,callback:a.callbackEnd-a.callbackStart,bootload_done_wait:a.callbackEnd-b,rdfd_requirelazy:e,rdfd_done_wait:f,rd_requirelazy:g,rd_done_wait:h}}}function e(a){a.start_time;var b=a.resources,d=a.durations;a=babelHelpers.objectWithoutPropertiesLoose(a,i);for(b of c("objectEntries")(b)){var e=b[0],f=b[1];for(f of c("objectEntries")(f)){var g=f[0],h=f[1];for(h of c("objectEntries")(h)){var j=h[0],k=h[1];a[e+"_"+g+"_resources_"+j]=Math.round(Number(k))}}}for(j of c("objectEntries")(d)){k=j[0];h=j[1];a[k+"_duration"]=Math.round(Number(h))}if(a.payloadStats){for(g of c("objectEntries")(a.payloadStats)){f=g[0];e=g[1];for(b of c("objectEntries")(e)){d=b[0];k=b[1];a[f+"_"+d+"_count"]=Math.round(Number(k))}}delete a.payloadStats}return a}g.computeHRData=a;g.computeBLData=b;g.flattenData=e}),98);
__d("BootloaderLoggingStatusEnum",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum").Mirrored(["SUCCESS","TIMEOUT","ERROR"]);c=a;f["default"]=c}),66);
__d("CometBootloaderErrorsFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1109");b=d("FalcoLoggerInternal").create("comet_bootloader_errors",a);e=b;g["default"]=e}),98);
__d("CometBootloaderErrorLoggerUtil",["BootloaderEvents","BootloaderEventsPerf","CometBootloaderErrorsFalcoEvent","CometTimeSpentNavigation","ResourceTimingStore","SiteData","performanceNavigationStart"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.parent_lid;d("ResourceTimingStore").init();var e=function(a){return{ms_since_navstart:Math.round(a-c("performanceNavigationStart")()),parent_lid:b,pkg_cohort:c("SiteData").pkg_cohort,request_path:(a=c("CometTimeSpentNavigation").getPathInfo())==null?void 0:a.name,svn_rev:c("SiteData").client_revision}},f=function(a,b){var f=d("BootloaderEventsPerf").computeBLData(a.bootloaderData),g=d("BootloaderEventsPerf").flattenData(f);c("CometBootloaderErrorsFalcoEvent").log(function(){var c=babelHelpers["extends"]({},g,e(f.start_time),{status:b,was_offline:a.offline});a.erroredResources!=null&&(c.errored_resource_urls=Array.from(a.erroredResources));return c})};d("BootloaderEvents").onBootloadError(function(a){f(a,"ERROR")})}g.initLogging=a}),98);
__d("CometBootloaderEventsFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("177");b=d("FalcoLoggerInternal").create("comet_bootloader_events",a);e=b;g["default"]=e}),98);
__d("HasteResponseFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1823926");b=d("FalcoLoggerInternal").create("haste_response",a);e=b;g["default"]=e}),98);
__d("CometBootloaderLoggerUtil",["BootloaderEvents","BootloaderEventsPerf","CometBootloaderEventsFalcoEvent","CometTimeSpentNavigation","HasteResponseFalcoEvent","ResourceTimingStore","SiteData","UserTimingUtils","gkx","performance","performanceNavigationStart"],(function(a,b,c,d,e,f,g){"use strict";var h,i=!1,j=c("gkx")("10211");function a(a){var b=a.bl_sample_rate,e=a.hr_sample_rate,f=a.parent_lid;if(i||!(b||e||j===!0))return;i=!0;d("ResourceTimingStore").init();var g=function(a){return{ms_since_navstart:Math.round(a-c("performanceNavigationStart")()),parent_lid:f,pkg_cohort:c("SiteData").pkg_cohort,request_path:(a=c("CometTimeSpentNavigation").getPathInfo())==null?void 0:a.name,svn_rev:c("SiteData").client_revision}};e&&d("BootloaderEvents").onHasteResponse(function(a){return c("HasteResponseFalcoEvent").log(function(){var b=d("BootloaderEventsPerf").computeHRData(a),c=d("BootloaderEventsPerf").flattenData(b);return babelHelpers["extends"]({},c,g(b.start_time))})});j&&(d("BootloaderEvents").onBootload(function(a){d("UserTimingUtils").measureModern("Bootloader: "+a.components.join(", "),{end:a.callbackEnd-(h||(h=c("performance"))).timeOrigin,start:a.startTime-h.timeOrigin},"Bootloader Events")}),d("BootloaderEvents").onHasteResponse(function(a){d("UserTimingUtils").measureModern("Haste: "+a.source,{end:a.jsmodsEnd-(h||(h=c("performance"))).timeOrigin,properties:[["Source Detail",a.sourceDetail]],start:a.startTime-h.timeOrigin},"Bootloader Events")}));var k=function(a,b){var e=d("BootloaderEventsPerf").computeBLData(a),f=d("BootloaderEventsPerf").flattenData(e);c("CometBootloaderEventsFalcoEvent").log(function(){return babelHelpers["extends"]({},f,g(e.start_time),{status:b})})};b&&d("BootloaderEvents").onBootload(function(a){return k(a,"SUCCESS")});d("BootloaderEvents").onBootloaderCallbackTimeout(function(a){return k(a,"TIMEOUT")})}g.initLogging=a}),98);
__d("EBAPIMinosVerifySingleEpoch",["EBMinosLogger","EBMinosWasmVerifySingleEpoch","WAGetSafeQPLError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("EBMinosLogger").minosLogger.DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["minosVerifySingleEpoch start"])));var b=a.qplFlow,c=a.minosEpochAnonId,e=a.minosMailboxAuthPublicKey,f=a.minosMailboxEncryptionPublicKey,g=a.minosMailboxSigningPublicKey,j=a.userId,k=a.selfEpochSignature;try{c={epochNumber:c,mailboxAuthPk:e,mailboxEncryptionPk:f,mailboxSigningPk:g,previousEpochHead:a.previousEpochHead==null?void 0:a.previousEpochHead,userFbid:j};b.addPoint("verify_single_epoch_start");e=(yield d("EBMinosWasmVerifySingleEpoch").verifySingleEpoch({epochPublicData:c,signature:k}));b.addPoint("verify_single_epoch_end");if(e.success){b.endSuccess();return e.value.valid}d("EBMinosLogger").minosLogger.ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Unable to verify epoch - WASM error ",""])),e.error);b.endFailWithError("invalid-result",e.error);return!1}catch(a){b.endFailWithError("runtime-error",d("WAGetSafeQPLError").getSafeQPLErrorMessage(a));return!1}});return j.apply(this,arguments)}g.minosVerifySingleEpoch=a}),98);
__d("EBMinosVerifySingleEpoch",["EBAPIMinosVerifySingleEpoch","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c,d,e,f,g,h){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f,g,i,j,k){a=(yield d("EBAPIMinosVerifySingleEpoch").minosVerifySingleEpoch({minosEpochAnonId:a,minosMailboxAuthPublicKey:g,minosMailboxEncryptionPublicKey:f,minosMailboxSigningPublicKey:e,previousEpochHead:i,qplFlow:k,selfEpochSignature:j,userId:c}));return(h||(h=b("Promise"))).resolve([a])});return i.apply(this,arguments)}g.minosVerifySingleEpoch=a}),98);
__d("EBWriteMinosMailboxKeysToCache",["EBAPIWriteMinosPublicKeysForRecipient","FBLogger","Promise","WAGetSafeQPLError","cr:16361","getErrorSafe","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){var e=a.contactId,f=a.encryptionPublicKey,g=a.epochAnonId,j=a.epochHead,k=a.epochHeadCreationTime,l=a.publicKeyFbid,m=a.qplFlow;m.addPoint("write_keys_start",{string:{contactId:e}});b("cr:16361")!=null&&c("promiseDone")(b("cr:16361").writeStorageAlertAndAdminMessageBridgedAPI(e,j,k));c("promiseDone")(d("EBAPIWriteMinosPublicKeysForRecipient").writeMinosMailboxKeysForRecipientAPI({contactId:e,encryptionPublicKey:f,epochAnonId:g,epochHead:j,epochHeadCreationTime:k,publicKeyFbid:l}),function(){m.addPoint("write_keys_end"),m.endSuccess()},function(a){a=c("getErrorSafe")(a);m.addPoint("write_keys_end");c("FBLogger")("wmi").MUSTFIX(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web minos] error writing minos mailbox keys to cache: ",""])),a.message);m.endFailWithError("runtime-error",d("WAGetSafeQPLError").getSafeQPLErrorMessage(a))});return(i||(i=b("Promise"))).resolve()}g.writeMinosMailboxKeysToCache=a}),98);
__d("EncryptedBackupUploadFailureFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5728");b=d("FalcoLoggerInternal").create("encrypted_backup_upload_failure",a);e=b;g["default"]=e}),98);
__d("LSDataTraceType",[],(function(a,b,c,d,e,f){a=Object.freeze({TASK:1,SYNC:2,RECEIVE_MSG:3,RICH_MEDIA_SEND:4,RICH_MEDIA_DOWNLOAD:5,TASK_CLIENT_MODE:6,ENCRYPTED_BACKUPS_FETCH_BACKUP_STATUS:69,ENCRYPTED_BACKUPS_INIT:70,ENCRYPTED_BACKUPS_ADD_DEVICE:71,ENCRYPTED_BACKUPS_UPLOAD:72,ENCRYPTED_BACKUPS_RESTORE:73,ENCRYPTED_BACKUPS_DELETE_BACKUP:75,ENCRYPTED_BACKUPS_CREATE_EXTRA_VIRTUAL_DEVICE:76,ENCRYPTED_BACKUPS_QR_ADD_DEVICE:77,ENCRYPTED_BACKUPS_SYNC_EPOCHS:78,ENCRYPTED_BACKUPS_OPEN_EPOCH:79,ENCRYPTED_BACKUPS_OPT_OUT_OF_BACKUP:80,ENCRYPTED_BACKUPS_MEDIA_BACKUP:81,ENCRYPTED_BACKUPS_MEDIA_RESTORE:82,ENCRYPTED_BACKUPS_THIRD_PARTY_ID_GENERATION:83,ENCRYPTED_BACKUPS_FETCH_BACKUPS_METADATA:86,ENCRYPTED_BACKUPS_REMOVE_VIRTUAL_DEVICE:87,ENCRYPTED_BACKUPS_QR_ADD_DEVICE_RECEIVER:88,ENCRYPTED_BACKUPS_DERIVE_AND_STORE_EPOCHS:89,ENCRYPTED_BACKUPS_GET_OPEN_EPOCH_KEYS:90,ENCRYPTED_BACKUPS_END_TO_END_THREAD_RESTORE:190,SAP_VESTA_REGISTRATION:251,SAP_VESTA_LOGIN:252,ENCRYPTED_BACKUPS_SHADOW_FETCH_BACKUP_STATUS:197,ENCRYPTED_BACKUPS_SHADOW_INIT:198,ENCRYPTED_BACKUPS_SHADOW_ADD_DEVICE:199,ENCRYPTED_BACKUPS_SHADOW_UPLOAD:200,ENCRYPTED_BACKUPS_SHADOW_RESTORE:201,ENCRYPTED_BACKUPS_SHADOW_DELETE_BACKUP:203,ENCRYPTED_BACKUPS_SHADOW_CREATE_EXTRA_VIRTUAL_DEVICE:204,ENCRYPTED_BACKUPS_SHADOW_QR_ADD_DEVICE:205,ENCRYPTED_BACKUPS_SHADOW_SYNC_EPOCHS:206,ENCRYPTED_BACKUPS_SHADOW_OPEN_EPOCH:207,ENCRYPTED_BACKUPS_SHADOW_QR_ADD_DEVICE_RECEIVER:216,ENCRYPTED_BACKUPS_ENCRYPTION_VERSIONING_UPSERT_VERSION_DATA:240,ENCRYPTED_BACKUPS_ENCRYPTION_VERSIONING_DELETE_VERSION_DATA:241,ENCRYPTED_BACKUPS_ENCRYPTION_VERSIONING_SYNC_VERSION_DATA:242,ENCRYPTED_BACKUPS_MESSAGE_INTEGRITY_CHECKER:243});f["default"]=a}),66);
__d("LsDataTraceFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1743851");b=d("FalcoLoggerInternal").create("ls_data_trace",a);e=b;g["default"]=e}),98);
__d("LSDataTraceFlush",["ArmadilloDataTraceType","I64","LSDataTraceType","LSIntEnum","LsDataTraceFalcoEvent","ODS","Promise","ReQL","asyncToGeneratorRuntime","clearTimeout","gkx","promiseDone","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=(i||(i=d("I64"))).of_string("120000"),m=i.of_string("600000"),n=new Set(["encrypted_backups_upload","encrypted_backups_media_backup"]);function o(a,b,c){var e=a.length;if(e===0)return[(i||(i=d("I64"))).neg_one,i.neg_one,void 0,void 0,void 0];e=a.find(function(a){return a.errorMessage!=null});e=e==null?void 0:e.errorMessage;a=a[a.length-1|0];var f=(i||(i=d("I64"))).of_float(Date.now()),g=a.timestampMs,h=i.compare(i.sub(f,c),l)>=0;return!b&&h?[(i||(i=d("I64"))).sub(f,c),a.checkPointId,g,e,"trace expired"]:[i.sub(g,c),a.checkPointId,g,e,e]}function p(a){return a.reduce(function(a,b,c){var e,f=(i||(i=d("I64"))).to_string(b.checkPointId),g=b.timestampMs;e=i.to_string((e=b.syncChannel)!=null?e:(i||(i=d("I64"))).neg_one);b=b.tags;b=b!=null?","+b:"";if(c===0)a.pointsList="".concat("(",f,",",e,b,")");else{c=String((i||(i=d("I64"))).to_int32(i.sub(g,a.lastCheckPointTimestamp)));a.pointsList=a.pointsList.concat("-",c,"-(",f,",",e,b,")")}a.lastCheckPointTimestamp=g;return a},{lastCheckPointTimestamp:(i||(i=d("I64"))).zero,pointsList:""}).pointsList}var q=i.of_string("2");function r(a){var b=a.traceType;b=(i||(i=d("I64"))).equal(b,(k||(k=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").TASK))?"send":(i||(i=d("I64"))).equal(b,d("ArmadilloDataTraceType").armadilloMessageSend)?"armadillo send":(i||(i=d("I64"))).equal(b,(k||(k=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_UPLOAD))?"encrypted_backups_upload":(i||(i=d("I64"))).equal(b,(k||(k=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_RESTORE))?"encrypted_backups_restore":(i||(i=d("I64"))).equal(b,(k||(k=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_MEDIA_BACKUP))?"encrypted_backups_media_backup":(i||(i=d("I64"))).equal(b,(k||(k=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").SAP_VESTA_LOGIN))?"sap_vesta_login":(i||(i=d("I64"))).equal(b,(k||(k=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").SAP_VESTA_REGISTRATION))?"sap_vesta_registration":(i||(i=d("I64"))).equal(b,(k||(k=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_MEDIA_RESTORE))?"encrypted_backups_media_restore":(i||(i=d("I64"))).equal(b,(k||(k=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_SHADOW_INIT))?"shadow_encrypted_backups_init":(i||(i=d("I64"))).equal(b,(k||(k=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_SHADOW_ADD_DEVICE))?"shadow_encrypted_backups_add_device":(i||(i=d("I64"))).equal(b,(k||(k=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_SHADOW_UPLOAD))?"shadow_encrypted_backups_upload":(i||(i=d("I64"))).equal(b,(k||(k=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_SHADOW_RESTORE))?"shadow_encrypted_backups_restore":(i||(i=d("I64"))).equal(b,(k||(k=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_SHADOW_DELETE_BACKUP))?"shadow_encrypted_backups_delete_backup":a.contextTwo;return b}function s(a,b){var e=b.traceId,f=b.shouldFlush,g=r(b),h=b.traceType,j=(i||(i=d("I64"))).equal(h,d("ArmadilloDataTraceType").armadilloMessageSend)?"tam_message_send":b.contextOne,k=(i||(i=d("I64"))).equal(b.traceType,q)?void 0:b.predefinedId,l=b.initTimestampMs;return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.data_trace_addon.index("traceIdAddonId")).getKeyRange(e)).then(function(a){var b=o(a,f,l),h=b[0],m=b[1],n=b[3],q=b[4],r=a.length,s=p(a);c("LsDataTraceFalcoEvent").log(function(){return{check_point_count:(i||(i=d("I64"))).to_string(i.of_int32(r)),check_point_list:s,client_event_ts:i.to_string(i.of_float(Date.now())),cold_start_time:void 0,data_trace_id:e,database_id:j,delivered_messages:void 0,error_message:q,first_error_message:n,has_backgrounded:!1,last_check_point:i.to_string(m),latency:i.to_string(h),media_type:void 0,num_of_attachments:void 0,persisted_metadata:void 0,predefined_id:k,sent_rich_media_messages:void 0,sent_text_messages:void 0,start_time:i.to_string(l),trace_flow:g!=null?g:""}})}).then(function(){return a.data_trace_meta["delete"](e)})}function a(a,c){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.data_trace_meta).getKeyRange(c)).then(function(c){if(c!=null)return s(a,c);else return(h||(h=b("Promise"))).resolve()})}var t={contents:void 0};function u(a){return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.data_trace_meta.index("shouldFlushInitTimestampMsTraceId")).getKeyRange(!1).bounds({lt:d("ReQL").key((i||(i=d("I64"))).sub(i.of_float(Date.now()),l))})).then(function(a){if(c("gkx")("23914")){var b=(i||(i=d("I64"))).of_float(Date.now());return a.filter(function(a){var c=r(a);if(c!=null&&n.has(c)){c=(i||(i=d("I64"))).compare(i.sub(b,a.initTimestampMs),m)>=0;return c}return!0})}return a})}function v(a){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=(yield u(a.tables));if(c.length===0)return;return a.runInTransaction(function(a){return u(a).then(function(c){return(h||(h=b("Promise"))).all(c.map(function(b){return s(a,b)}))})},"readwrite",void 0,void 0,f.id+":310")});return w.apply(this,arguments)}function x(){var a=t.contents;if(a!=null){c("clearTimeout")(a);return}}function y(a){c("promiseDone")(v(a),function(){x();var b=c("setTimeout")(function(){y(a)},6e4);t.contents=b},function(){x(),(j||(j=d("ODS"))).bumpEntityKey(3185,"mw_trace","error")});return x}e=a;a=y;e={flush:e,flushExpiredDataTraces:a};g["default"]=e}),98);
__d("XPlatReactVoprf.shared",[],(function(a,b,c,d,e,f){"use strict";a=function(a){function b(b){var c;c=a.call(this,b)||this;c.message=b;return c}babelHelpers.inheritsLoose(b,a);return b}(babelHelpers.wrapNativeSuper(Error));f.VoprfWasmError=a}),66);
__d("mapVoprfWasmError",["XPlatReactVoprf.shared"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case-1:return new h();case 1:return new i();case 2:return new j();case 3:return new k();case 4:return new l();default:return new m()}}var h=function(a){function b(b){b===void 0&&(b="Unknown error encountered by VOPRF WASM");b=a.call(this,b)||this;b.name="VoprfUnknownError";return b}babelHelpers.inheritsLoose(b,a);return b}((b=d("XPlatReactVoprf.shared")).VoprfWasmError),i=function(a){function b(b){b===void 0&&(b="Incorrect buffer length encountered by VOPRF WASM");b=a.call(this,b)||this;b.name="VoprfBufferLengthError";return b}babelHelpers.inheritsLoose(b,a);return b}(b.VoprfWasmError),j=function(a){function b(b){b===void 0&&(b="Error while performing curve operation by VOPRF WASM");b=a.call(this,b)||this;b.name="VoprfCurveOperationError";return b}babelHelpers.inheritsLoose(b,a);return b}(b.VoprfWasmError),k=function(a){function b(b){b===void 0&&(b="Error while performing hash operation by VOPRF WASM");b=a.call(this,b)||this;b.name="VoprfHashOperationError";return b}babelHelpers.inheritsLoose(b,a);return b}(b.VoprfWasmError),l=function(a){function b(b){b===void 0&&(b="Error while performing proof operation by VOPRF WASM");b=a.call(this,b)||this;b.name="VoprfProofError";return b}babelHelpers.inheritsLoose(b,a);return b}(b.VoprfWasmError),m=function(a){function b(b){b===void 0&&(b="Unknown error code received from WASM binary");b=a.call(this,b)||this;b.name="UnknownErrorCode";return b}babelHelpers.inheritsLoose(b,a);return b}(b.VoprfWasmError);g.mapVoprfWasmError=a;g.VoprfUnknownError=h;g.VoprfBufferLengthError=i;g.VoprfCurveOperationError=j;g.VoprfHashOperationError=k;g.VoprfProofError=l;g.UnknownErrorCode=m}),98);
__d("LSVoprfWasmBuilder",["FBLogger","Promise","asyncToGeneratorRuntime","err","getErrorSafe","mapVoprfWasmError"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return function(d){var e=d.locateFile!=null?{locateFile:d.locateFile}:{instantiateWasm:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{var e=(yield d.getWasmModule());e=(yield WebAssembly.instantiate(e,a));b(e);return{}}catch(b){a=c("getErrorSafe")(b);c("FBLogger")("LSVoprfWasmBuilder").mustfix("instantiateWasm failed with error: %s",a.toString());return!1}});function e(b,c){return a.apply(this,arguments)}return e}()};return i(e,a)}}function i(a,e){return new(h||(h=b("Promise")))(function(b,f){e(a).then(function(a){var e=a._sodiumInit();e!==0&&f(c("err")("Failed to initialize Sodium!"));b({createCurveRistretto:function(){var b;try{b=a._curve_create();a._curve_init_ristretto(b);return b}catch(c){b!=null&&a._curve_free(b);throw c}},freeCurve:function(b){a._curve_free(b)},createVoprfExpTwohashdh:function(b){var c;try{c=a._voprf_create();a._voprf_init_exp_twohashdh(c,b);return c}catch(b){c!=null&&a._voprf_free(c);throw b}},freeVoprf:function(b){a._voprf_free(b)},getCurveBytes:function(b){return a._get_curve_element_bytes(b.curvePtr)},getCurveScalarBytes:function(b){return a._get_curve_scalar_bytes(b.curvePtr)},blind:function(b,c){var e,f,g;try{var h=a._get_curve_element_bytes(b.curvePtr),i=a._get_curve_scalar_bytes(b.curvePtr);e=a._malloc(h);f=a._malloc(i);g=k(a,c);b=a._blind(b.voprfPtr,e,h,f,i,g,c.length);if(b!==0)throw d("mapVoprfWasmError").mapVoprfWasmError(b);c=j(a,e,h);b=j(a,f,i);return{blindedElement:c,blindingFactor:b}}finally{[e,f,g].forEach(function(b){b!=null&&a._free(b)})}},verifiableUnblind:function(b,c,e,f,g,h,i,l){var m,n,o,p,q,r,s;try{m=c?k(a,c):null;n=e?k(a,e):null;o=k(a,h);p=k(a,f);q=k(a,g);r=k(a,i);var t=a._get_curve_element_bytes(b.curvePtr);s=a._malloc(t);b=a._verifiable_unblind(b.voprfPtr,s,t,m,c?c.length:0,n,e?e.length:0,p,f.length,q,g.length,o,h.length,r,i.length,+l);if(b!==0)throw d("mapVoprfWasmError").mapVoprfWasmError(b);c=j(a,s,t);return{unblindedElement:c}}finally{[m,n,o,p,q,r,s].forEach(function(b){b!=null&&a._free(b)})}},clientFinalize:function(b,c,e){var f,g,h;try{f=k(a,c);g=k(a,e);var i=a._get_voprf_final_evaluation_bytes(b.voprfPtr);h=a._malloc(i);b=a._voprf_client_finalize(b.voprfPtr,h,i,f,c.length,g,e.length);if(b!==0)throw d("mapVoprfWasmError").mapVoprfWasmError(b);c=j(a,h,i);return{finalEvaluation:c}}finally{[f,g,h].forEach(function(b){b!=null&&a._free(b)})}},setup:function(b){var c,e;try{var f=a._get_curve_scalar_bytes(b.curvePtr),g=a._get_curve_element_bytes(b.curvePtr);c=a._malloc(f);e=a._malloc(g);b=a._voprf_setup(b.voprfPtr,e,g,c,f);if(b!==0)throw d("mapVoprfWasmError").mapVoprfWasmError(b);b=j(a,e,g);g=j(a,c,f);return{sk:b,pk:g}}finally{[c,e].forEach(function(b){b!=null&&a._free(b)})}},evaluate:function(b,c,e,f){var g,h,i,l,m;try{var n=a._get_curve_element_bytes(b.curvePtr);g=a._malloc(n);var o=f?a._get_curve_scalar_bytes(b.curvePtr):0;h=o>0?a._malloc(o):null;var p=f?a._get_curve_scalar_bytes(b.curvePtr):0;i=p>0?a._malloc(p):null;l=k(a,e);m=k(a,c);b=a._voprf_evaluate(b.voprfPtr,g,n,h,o,i,p,m,c.length,l,e.length,+f);if(b!==0)throw d("mapVoprfWasmError").mapVoprfWasmError(b);c=h!==null?j(a,h,o):null;e=i!==null?j(a,i,p):null;f=j(a,g,n);return{proofC:c,proofS:e,evaluatedElement:f}}finally{[g,h,i,l,m].forEach(function(b){b!=null&&a._free(b)})}},serverFinalize:function(b,c,e){var f,g,h;try{f=k(a,c);g=k(a,e);var i=a._get_voprf_final_evaluation_bytes(b.voprfPtr);h=a._malloc(i);b=a._voprf_server_finalize(b.voprfPtr,h,i,f,c.length,g,e.length);if(b!==0)throw d("mapVoprfWasmError").mapVoprfWasmError(b);c=j(a,h,i);return{finalEvaluation:c}}finally{[f,g,h].forEach(function(b){b!=null&&a._free(b)})}},wasmMemory:(e=a.wasmMemory)!=null?e:void 0})})["catch"](function(a){throw c("err")("Failed to initialize wasm module, "+a)})})}function j(a,b,c){var d=new Uint8Array(c);for(var e=0;e<c;++e)d[e]=a.getValue(e+b,"i8");return d}function k(a,b){var c=b.length;c=a._malloc(c);a.writeArrayToMemory(b,c);return c}g["default"]=a}),98);
__d("LSVoprfWasm",["LSVoprfWasmBuilder","bx","ls_voprf_utils_v2"],(function(a,b,c,d,e,f,g){"use strict";var h=c("bx").getURL(c("bx")("30933"));a=function(){return h};b=c("LSVoprfWasmBuilder")(c("ls_voprf_utils_v2"));g.locateFile=a;g.LSVoprfWasm=b}),98);
__d("LogWebQplNOP",["I64","LSIntEnum","Promise","QPLUserFlow","WAHashStringToNumber","WALogger","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function l(a){a=a==null?null:(k||(k=d("I64"))).to_int32(a);switch(a){case 521476165:return c("qpl")._(521476165,"2432");case 521481602:return c("qpl")._(521481602,"829");default:return null}}function a(a,e,f,g,m,n){return new(i||(i=b("Promise")))(function(b,i){try{i=m?(j||(j=d("LSIntEnum"))).unwrapIntEnum(m):null;var o=l(e);if(o!=null&&f!=null){i={"int":{num_messages:(k||(k=d("I64"))).to_int32(g)},string:{message_count:String(g),taskSource:(i=i==null?void 0:i.toString())!=null?i:"unknown"}};n===!0?c("QPLUserFlow").endSuccess(o,{annotations:i,instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)}):n===!1?c("QPLUserFlow").endFailure(o,f,{annotations:i,instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)}):(c("QPLUserFlow").addAnnotations(o,i,{instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)}),c("QPLUserFlow").addPoint(o,f,{instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)}))}b()}catch(a){d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["LSLogWebQpl error: ",""])),a),b()}})}g.call=a}),98);
__d("MAWClientConsistencyRefresh",["ClientConsistencyEventEmitter","CurrentAppID"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(d("CurrentAppID").getAppID()){case 772021112871879:c("ClientConsistencyEventEmitter").emit("hardRefresh",a);break;default:c("ClientConsistencyEventEmitter").emit("softRefresh",a)}}g["default"]=a}),98);
__d("MAWWorkerOnClose",["MAWSetupWorkerAuxStateForLogging","MAWWaitForBackendSetup","MAWWebWorkerSingleton","QPLUserFlow","pageID","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=c("qpl")._(1056841865,"2862");function a(a,b,e){c("QPLUserFlow").start(h,{annotations:{string:{currentWorkerId:d("MAWWaitForBackendSetup").getCurrentWorkerID(),pageID:c("pageID"),terminationMsgType:b,terminationReason:a,workerID:e},string_array:{pastWorkerTerminationMsgTypes:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes,pastWorkerTerminationReasons:d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons}}})}function b(a){c("promiseDone")(d("MAWWebWorkerSingleton").getWorkerHealthStatus(),function(b){return c("QPLUserFlow").endSuccess(h,{annotations:{bool:babelHelpers["extends"]({},b.data),string:{healthStatusAfter:b.tag,outcome:a}}})})}function e(a,b){c("promiseDone")(d("MAWWebWorkerSingleton").getWorkerHealthStatus(),function(d){return c("QPLUserFlow").endFailure(h,a,{annotations:{bool:babelHelpers["extends"]({},d.data),string:{healthStatusAfter:d.tag}},error:b})})}g.ON_WORKER_CLOSED_HANDLER_QPL=h;g.startQPL=a;g.success=b;g.fail=e}),98);
__d("MAWWorkerWatchdog",["MAWBridgeLoggingUtils","MAWBridgeSendAndReceive","MAWSetupWorkerAuxStateForLogging","MAWWaitForBackendSetup","MAWWebWorkerSingleton","MAWWorkerWatchdogRecovery","Promise","QPLUserFlow","err","justknobx","promiseDone","qpl","setInterval","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("justknobx")._("4240"),j=i/2,k=c("qpl")._(1056847415,"2909"),l=!1,m=!1,n=["shared_not_exists","shared_exists_not_connected"];function o(){var a;c("QPLUserFlow").start(k,{annotations:{bool:{workerTerminatedPermanently:(a=d("MAWSetupWorkerAuxStateForLogging")).WorkerLifeCycleState.workerTerminatedPermanently},"int":{workerAge:a.WorkerLifeCycleState.getWorkerAge()},string:{currentWorkerId:d("MAWWaitForBackendSetup").getCurrentWorkerID()},string_array:{pastWorkerTerminationMsgTypes:a.WorkerLifeCycleState.restartMessageTypes,pastWorkerTerminationReasons:a.WorkerLifeCycleState.restartReasons}}});return(h||(h=b("Promise"))).race([d("MAWBridgeSendAndReceive").sendAndReceive("backend",d("MAWBridgeLoggingUtils").HEARTBEAT_ROUTE),new h(function(a,b){c("setTimeout")(function(){b(c("err")("Armadillo web worker heartbeat timed out."))},j)})]).then(function(){c("QPLUserFlow").endSuccess(k),d("MAWSetupWorkerAuxStateForLogging").addWorkerHeartbeatToHistory("OK")},function(a){p(),d("MAWSetupWorkerAuxStateForLogging").addWorkerHeartbeatToHistory("ERROR"),c("promiseDone")(d("MAWWebWorkerSingleton").getWorkerHealthStatus(),function(b){return c("QPLUserFlow").endFailure(k,"heartbeat_timeout",{annotations:{bool:babelHelpers["extends"]({},b.data),string:{workerHealthStatus:b.tag}},error:a})})})}function p(){c("QPLUserFlow").addPoint(k,"starting-lock-based-recovery"),c("promiseDone")(d("MAWWebWorkerSingleton").getWorkerHealthStatus().then(function(a){var b=d("MAWWorkerWatchdogRecovery").getWorkerRecoveryForWatchdog(),c=d("MAWWaitForBackendSetup").getCurrentWorkerID();if(n.includes(a.tag)&&b!=null)return b("locks_based_recovery",c,"locks_based_recovery")}))}function a(){if(m)return;c("setInterval")(function(){if(!l)return;c("promiseDone")(o())},i);d("MAWWaitForBackendSetup").runAfterBackendSetup(function(){l=!0},d("MAWBridgeLoggingUtils").HEARTBEAT_ROUTE);m=!0}g.HEARTBEAT_TIMEOUT_INTERVAL=j;g.MAW_WORKER_HEARTBEAT_QPL=k;g.startWatchdog=a}),98);
__d("MAWSetupWorker",["CurrentAppID","Deferred","IGDWebUtils","MAWBridgeObserver","MAWClientConsistencyRefresh","MAWCommonSetupWorker","MAWCrossWorkerPortal","MAWInit","MAWLoggerUtils","MAWMIC","MAWSetupWorkerAuxStateForLogging","MAWUnrecoverableDbErrors","MAWWaitForBackendSetup","MAWWebWorkerSingleton","MAWWorkerOnClose","MAWWorkerWatchdog","MWFBLogger","QPLUserFlow","SharedWorkerBundleResource","SharedWorkerV2ResourceExperimental","asyncToGeneratorRuntime","cr:6600","gkx","promiseDone","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n=d("MWFBLogger").MWLogger().tags([d("MAWLoggerUtils").Tag.WorkerSetup,d("MAWLoggerUtils").Tag.MAWInit]),o=d("IGDWebUtils").isInstagramWebSupportedApp(Number(d("CurrentAppID").getAppID())),p=o?"IGDAWMainWorker":"MAWMainWorker",q=null,r=!1;function s(a){r=a,d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.workerTerminatedPermanently=a}function t(){return r}function u(a){switch(a){case"mawInit":return!0;case"mawReinitSetupMutex":case"mawReinitReregDevice":case"bridgeRecovery":case"workerUpgraded":case"rebootRequired":case"workerTerminated":default:return!1}}function v(a,b,c,d,e,f,g){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,k,l,m){if(t())throw n.mustfixThrow("Worker is permanently killed.");d("MAWWaitForBackendSetup").markBackendSetupStarted();var o=function(b){return v(a,e,f,g,b,l,m)};(k==="bridgeRecovery"||k==="backendSetupFailure")&&c("QPLUserFlow").addPoint(d("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,"create_worker_start");d("MAWWebWorkerSingleton").setOnCloseForWorkerInstance(function(a,b,e){d("MAWWorkerOnClose").startQPL(a,e,b);var f=a!=null?a:"unknown",g=F(f)&&d("MAWWaitForBackendSetup").isBackendSetupSettled();d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons.push(f);d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes.push(e!=null?e:"unknown");if(d("MAWWaitForBackendSetup").getCurrentWorkerID()==null||b!==d("MAWWaitForBackendSetup").getCurrentWorkerID()){d("MAWInit").MAWInit.logPoint(f+"_worker_termination_skipped");d("MAWMIC").addPoint(f+"_worker_termination_skipped");d("MAWWorkerOnClose").success(f+"_worker_restart_skipped");n.warn("Worker termination skipped %s. Terminate reason: %s, Worker: %s, current worker: %s",k,a,b,d("MAWWaitForBackendSetup").getCurrentWorkerID());return}d("MAWWaitForBackendSetup").resetCurrentWorkerSkipIdCheck();n.warn("Worker termination started %s. Terminate reason: %s, Worker: %s",k,a,b);d("MAWInit").MAWInit.logPoint(f+"_worker_terminated");d("MAWMIC").addPoint(f+"_worker_terminated");d("MAWInit").MAWInit.addStringArrayAnnotation("workerTerminationReason",d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons);d("MAWMIC").addStringArrayAnnotation("workerTerminationReason",d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartReasons);d("MAWInit").MAWInit.addStringArrayAnnotation("workerTerminationMsgType",d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes);d("MAWMIC").addStringArrayAnnotation("workerTerminationMsgType",d("MAWSetupWorkerAuxStateForLogging").WorkerLifeCycleState.restartMessageTypes);var h=a==="requested-upgrade"?"workerUpgraded":f+"_worker_terminated";c("promiseDone")(D(),function(){if(g){s(!0);n.warn("Tab displays soft refresh. Flow: %s",f);d("MAWInit").MAWInit.logPoint(f+"_soft_refresh");d("MAWMIC").addPoint(f+"_soft_refresh");c("MAWClientConsistencyRefresh")("maw_request_refresh");d("MAWWorkerOnClose").success("softRefresh");return}if(f!=="logout")return o(h).then(function(){return d("MAWWorkerOnClose").success(h)})["catch"](function(a){d("MAWInit").MAWInit.fail("worker_restart_failed",a),d("MAWWorkerOnClose").fail("workerUpgradeFailed",a),d("MAWWaitForBackendSetup").rejectBackendSetup(a)});else d("MAWWorkerOnClose").success("skip_logout")})});var r=(yield d("MAWWebWorkerSingleton").createWorkerIfNone(k)),u=r.worker;r=r.workerID;d("MAWWaitForBackendSetup").setCurrentWorker(r);r=new(c("Deferred"))();q=r.getPromise();(k==="bridgeRecovery"||k==="backendSetupFailure")&&c("QPLUserFlow").addPoint(d("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,"create_worker_end");var w=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();n.DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["worker setting up with reason: ",", use shared worker: ",""])),k,w);w&&u.addEventListener("message",function(a){var b;typeof a.data==="object"&&((b=a.data)==null?void 0:b.type)==="sw-shutdown"&&typeof a.data.response==="object"&&((b=a.data.response)==null?void 0:b.reason)==="maw-request-refresh"&&c("MAWClientConsistencyRefresh")("maw_request_refresh")});var x=new(d("MAWCommonSetupWorker").BridgeAdapter)(u,p);yield e(x);r.resolve(x);n.DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["bridge promise resolved"])));d("MAWMIC").addPoint(k+"_connect_to_backend");yield d("MAWInit").MAWInit.measurePerformance(k+"-init_backend",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=function(b){return d("MAWCommonSetupWorker").initWorker({bridge:x,ebState:b,onWorkerAlreadySetup:f,onWorkerRestart:o,reason:k,vaultMaterials:a})},c=w?yield b(m):yield x.fullyConnected.then(function(){return b(m)});d("MAWWaitForBackendSetup").resolveBackendSetup(c);n.DEBUG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["backend setup successful"])))}));return d("MAWWaitForBackendSetup").waitForBackendSetup("setup-worker")});return w.apply(this,arguments)}function a(a,b,e,f,g,h,i){i=v(a,b,e,f,g,h,i);u(g)&&c("promiseDone")(d("MAWWaitForBackendSetup").waitForBackendSetup("init bridge recovery observer").then(function(){d("MAWBridgeObserver").initUnackedMessagesObserver({onConnectToExistingWorker:e,onTerminateWorker:f,onWorkerConnect:b,updateWorkerState:h,vaultMaterials:a}),d("MAWWorkerWatchdog").startWatchdog()}));return i}function e(){return q}function x(a){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){n.debug("Terminating dedicated worker: %s. Bridge Promise: %s",a,!!q);if(!q){n.DEBUG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["worker doesn't exist, no need to terminate"])));return!1}n.DEBUG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["worker terminating: for ",""])),a);yield D();return!0});return y.apply(this,arguments)}function f(){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield x("terminateWorkerPermanently"),s(!0)});return z.apply(this,arguments)}function A(a,e){var f=c("gkx")("7313");return f?d("SharedWorkerV2ResourceExperimental").terminateSharedWorker(b("cr:6600"),a?"maw-request-refresh":e!=null?e:"unknown"):d("SharedWorkerBundleResource").terminateSharedWorker(b("cr:6600"),null,a?"maw-request-refresh":e!=null?e:"unknown")}function B(a){return C.apply(this,arguments)}function C(){C=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();if(b){n.debug("Terminating shared worker: %s",a);b=(yield A(!1,a).then(function(){return!0},function(){return!1}));n.DEBUG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Shared worker responded to termination request: ",""])),b)}else yield x(a)});return C.apply(this,arguments)}function D(){return E.apply(this,arguments)}function E(){E=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;n.debug("Updating worker state on termination");(a=(yield q))==null||a.close();q=null;d("MAWWaitForBackendSetup").resetBackendSetup();d("MAWCrossWorkerPortal").killPortalWhenWorkerTerminating();d("MAWWebWorkerSingleton").resetWorkerCreation()});return E.apply(this,arguments)}function F(a){if(a==="MAWEARKeychainDecryptionError"||d("MAWUnrecoverableDbErrors").isUnrecoverableDbErrorByName(a))return!0;return a==="update-required-fbid_change"||a==="update-required-vault_materials_change"?!0:!1}g.setPreventWorkerRestart=s;g.getOrSetupWorker=a;g.waitForWorkerSetup=e;g.terminateDedicatedWorker=x;g.terminateWorkerPermanently=f;g.killSharedWorker=A;g.terminateWorker=B}),98);
__d("MAWWorkerReboot",["EBIsEbEnabled","FBLogger","MAWBridgeObserver","MAWSetupWorker","MAWWaitForBackendSetup","ODS","Promise","QPLUserFlow","asyncToGeneratorRuntime","getErrorSafe","gkx","pageID","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a){(i||(i=d("ODS"))).bumpEntityKey(3185,"armadillo_shared_worker_reboot","shared_worker_reboot_"+a)}var k=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker(),l=function(a){switch(a){case"bridge_recovery":return"bridgeRecovery";case"backend_setup_failure":return"backendSetupFailure"}};function a(a,e,f,g,i,m){c("QPLUserFlow").start(d("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,{annotations:{bool:{isSharedWorker:k},string:{trigger:i,workerInitPageID:c("pageID")}}});c("FBLogger")("messenger_web").info("Rebooting worker started.");j("start");d("MAWWaitForBackendSetup").resetBackendSetup();var n=l(i);c("QPLUserFlow").addPoint(d("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,"terminate_worker_start");return new(h||(h=b("Promise")))(function(h,i){return d("MAWSetupWorker").terminateWorker(n).then(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){c("QPLUserFlow").addPoint(d("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,"terminate_worker_end");c("FBLogger")("messenger_web").info("Reboot process killed existing worker successfully.");var b;if(c("gkx")("1458"))try{b=(yield d("EBIsEbEnabled").isEBEnabled())}catch(a){c("FBLogger")("wmi_eb").mustfix("Failed to get EB state during worker reboot: %s",c("getErrorSafe")(a).message),b=void 0}else b=void 0;return d("MAWSetupWorker").getOrSetupWorker(a,e,f,g,n,m,b).then(function(a){c("FBLogger")("messenger_web").info("Rebooting worker success. Reason for reboot: %s",n),j("success"),c("QPLUserFlow").endSuccess(d("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL),e(a),h()})}))["catch"](function(a){c("FBLogger")("messenger_web").info("Rebooting worker failed. Error message: %s",a.message),j("fail"),c("QPLUserFlow").endFailure(d("MAWBridgeObserver").BAD_STATE_RECOVERY_QPL,a.message),d("MAWWaitForBackendSetup").rejectBackendSetup(a),i(a)})})}g.rebootWorker=a}),98);
__d("MAWBridgeObserver",["FBLogger","MAWWaitForBackendSetup","MAWWorkerReboot","promiseDone","qex","qpl"],(function(a,b,c,d,e,f,g){"use strict";a=c("qpl")._(1056840252,"808");var h=5,i=[],j=!1,k,l=function(){i=[]};b=function(a){if(!o())return;if(d("MAWWaitForBackendSetup").isBackendSetupInProgress()){l();return}if(n().length>=h&&!d("MAWWaitForBackendSetup").isBackendSetupInProgress()){c("FBLogger")("messenger_web").info("Minimum threshold of unacked messages reached: %s. Unacked messages: %s",h,JSON.stringify(n()));var b=c("qex")._("440"),e=c("qex")._("468")||h;b===!0&&n().length>=e?(c("FBLogger")("messenger_web").info("QE threshold of unacked messages reached: %s. Unacked messages: %s",h,JSON.stringify(n())),l(),c("promiseDone")(m())):(c("FBLogger")("messenger_web").info("Bridge recovery attempt skipped. Reason for skipped: maw_bridge_recovery_v2_enabled: %s, maw_bridge_recovery_threshold: %s",b,e),i.push(a))}else i.push(a)};var m=function(){c("FBLogger")("messenger_web").info("Starting bridge recovery attempt.");return d("MAWWorkerReboot").rebootWorker(k.vaultMaterials,k.onWorkerConnect,k.onConnectToExistingWorker,k.onTerminateWorker,"bridge_recovery",k.updateWorkerState).then(function(){c("FBLogger")("messenger_web").info("Bridge recovery attempt successful. Worker has restarted.")},function(a){c("FBLogger")("messenger_web").info("Bridge recovery attempt failed. Worker has failed to restart. Error: %s",a.message);throw a})};e=function(a){j=!0,k=a};var n=function(){return i},o=function(){return j};f=function(){return k};g.BAD_STATE_RECOVERY_QPL=a;g.MIN_UNACKED_EVENTS_THRESHOLD=h;g.resetUnackedMessages=l;g.notifyUnackedEvent=b;g.attemptRecovery=m;g.initUnackedMessagesObserver=e;g.getUnackedMessages=n;g.getIsObserverActive=o;g.getProps=f}),98);
__d("MAWGetDBVersionForTest",["justknobx"],(function(a,b,c,d,e,f,g){"use strict";function a(){if(!c("justknobx")._("1495"))return;var a=new URL(document.location.href);a=a.searchParams.get("db_version");if(a==null)return;if(a==="current"||a==="latest")return a;a=parseInt(a,10);if(Number.isInteger(a))return Number(a)}g.getDbVersionForTest=a}),98);
__d("MAWCommonSetupWorker",["Deferred","FBLogger","MAWCurrentUser","MAWGetDBVersionForTest","MAWInit","MAWMIC","MAWSetupWorker","MAWWaitForBackendSetup","MAWWebWorkerSingleton","MessengerWebInitData","Promise","WADevToolMessageChannel","WALogger","WorkerClient","WorkerMessagePort","err","gkx","pageID","promiseDone","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("gkx")("3282");e=function(a){function b(b,c){var e;e=a.call(this,b,c)||this;e.onmessage=null;e.$BridgeAdapter$p_1=b;d("WorkerClient").init(e);e.onUnhandledMessage.add(function(a){e.onmessage&&e.onmessage({data:a})});e.addMessageListener("worker-setup",function(a){a.status==="worker-ready"&&d("MAWInit").MAWInit.addBoolAnnotation("workerReadyReceived",!0)});return e}babelHelpers.inheritsLoose(b,a);var c=b.prototype;c.getBridgePort=function(){return this};return b}(d("WorkerMessagePort").WorkerSyncedMessagePort);function a(a){var b=a.bridge,e=a.ebState,f=a.reason,g=a.vaultMaterials,h=new(c("Deferred"))();b.addMessageListener("worker-setup",function(b){return k(a,h,b)});b.addMessageListener("worker-setup-ack",function(a){return l(a,f)});n(b,g,e);c("promiseDone")(d("MAWWebWorkerSingleton").doesWorkerExist(),function(a){return d("MAWInit").MAWInit.addBoolAnnotation("workerExistsOnSetup",a)});c("promiseDone")(d("MAWWebWorkerSingleton").getWorkerHealthStatus(),function(a){return d("MAWInit").MAWInit.addStringAnnotation("workerHealthStatus",a.tag)});return h.getPromise()}function k(a,b,e){var f;if(e.setupHash!==c("pageID"))return;switch(e.status){case"success":b.resolve(a.bridge.getBridgePort());break;case"failure":b.reject(c("err")((f=e.msg)!=null?f:"Error setting up worker"));break;case"already-setup":return m(a,b,e);default:d("MAWInit").MAWInit.addBoolAnnotation("invalidSetupMessageReceived",!0);throw c("FBLogger")("messenger_web").mustfixThrow("Invalid message for worker: "+e.status)}}function l(a,b){if(a.setupHash!==c("pageID"))return;d("MAWInit").MAWInit.logPoint(b+"_backend_setup_ack");d("MAWMIC").addPoint(b+"_backend_setup_ack");a=(b=a.backendState)!=null?b:"none";d("MAWInit").MAWInit.addStringAnnotation("backendAckState",a);d("MAWMIC").addStringAnnotation("backendAckState",a)}function m(a,e,f){var g=a.bridge,j=a.onWorkerAlreadySetup,k=a.onWorkerRestart;a=a.reason;switch(f.action){case"no-action":e.resolve(g.getBridgePort());j();d("MAWInit").MAWInit.logPoint(a+"_backend_already_setup");d("MAWMIC").addPoint(a+"_backend_already_setup");break;case"reboot-required":d("WALogger").DEV(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Terminating worker and rebooting..."])));d("MAWMIC").addPoint(a+"_worker_rebooting");d("MAWInit").MAWInit.logPoint(a+"_worker_rebooting");j=(g=f==null?void 0:f.reason)!=null?g:"none";d("MAWInit").MAWInit.addStringAnnotation("workerRebootReason",j);d("MAWMIC").addStringAnnotation("workerRebootReason",j);a=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()?(i||(i=b("Promise"))).resolve(d("MAWWaitForBackendSetup").resetCurrentWorkerWithId(d("MAWWaitForBackendSetup").getCurrentWorkerID())):d("MAWSetupWorker").terminateDedicatedWorker("reboot required");return a.then(function(){return k("rebootRequired").then(function(a){return e.resolve(a)})["catch"](function(a){return e.reject(a)})});default:f.action;throw c("FBLogger")("messenger_web").mustfixThrow("Invalid action for worker-setup:already-setup: "+f.action)}}function n(a,b,e){e={content:{createdAt:c("MessengerWebInitData").createdAt,ebState:e,fbId:d("MAWCurrentUser").getID(),sessionId:c("MessengerWebInitData").sessionId,testDbVersion:d("MAWGetDBVersionForTest").getDbVersionForTest(),userKeyBase:c("MessengerWebInitData").userKeyBase,vaultMaterials:b},setupHash:c("pageID"),type:"worker-setup"};if(j){d("MAWInit").MAWInit.addBoolAnnotation("devToolsEnabled",!0);b=d("WADevToolMessageChannel").createNewChannel();e.content.devToolMessageChannelPort2=b.port2;a.postMessage(e,[b.port2])}else a.postMessage(e)}g.BridgeAdapter=e;g.initWorker=a}),98);
__d("MAWDefaultE2eeOneToOneEligibility",["LSContactBitOffset"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a.maybeContact;a=a!=null&&d("LSContactBitOffset").has(83,a);return a}g.isContactDefaultE2eeOneToOneEligible=a}),98);
__d("MAWMainThreadLogger",["CurrentMessengerUser","FBLogger","MAWAppVersion","MAWConsoleLogger","MAWDeleteOldLogsFromDisk","MAWLeakDetection","MAWLoggerUtils","MAWLoggingSwitches","MAWSaveLogToDisk","Promise","WAJids","WATagsLogger","asyncToGeneratorRuntime","err","getErrorSafe","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i=!1;function a(){i=!1}function e(){i||(i=!0,d("WATagsLogger").initializeWaLogger(t))}var j=function(){return c("FBLogger")("messenger_web")};function k(a,b){a=l(a);a!=null&&d("MAWLoggerUtils").logToHistory("log",a,b,!1)}function l(a){if(!d("CurrentMessengerUser").isEmployee()&&!d("CurrentMessengerUser").isTestUser())return;a=d("WAJids").maybeSanitizeLogLineText(a);a=d("MAWLeakDetection").maybeReplaceVaultedString(a);return a}function f(a,b){a=d("WAJids").maybeSanitizeLogLineText(a);a=d("MAWLeakDetection").maybeReplaceVaultedString(a);d("MAWLoggerUtils").logToHistory("log",a,b,!1)}function m(a,b){a=d("WAJids").maybeSanitizeLogLineText(a);a=d("MAWLeakDetection").maybeReplaceVaultedString(a);d("MAWLoggerUtils").logToHistory("log",a,b,!1)}function n(a,b){a=d("WAJids").maybeSanitizeLogLineText(a);a=d("MAWLeakDetection").maybeReplaceVaultedString(a);j().tags(b.map(function(a){return String(a)})).warn(a)}function o(a,b,d,e,f,g){d=c("err")(d);d.stack=e;c("promiseDone")(r(a,b,d,f,g))}function p(a,b){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){a=d("MAWLeakDetection").maybeReplaceVaultedString(d("WAJids").maybeSanitizeLogLineText(a));var e=d("MAWLoggingSwitches").removeLoggingFromBridge?d("MAWSaveLogToDisk").getLastNEntries(c):(h||(h=b("Promise"))).resolve([]);c=c===0?[]:[].concat((yield e).map(function(a){return a.args}));return{logs:[].concat(c),sanitizedMessage:a}});return q.apply(this,arguments)}function r(a,b,c,d,e){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g){a=d("MAWLeakDetection").maybeReplaceVaultedString(d("WAJids").maybeSanitizeLogLineText(a));a=e!=null?e:c("err")(a);f=f!=null?f:e==null?2:0;e=g!=null?g:0;g=(yield p(a.message,e));e=g.logs;g=g.sanitizedMessage;var h=c("getErrorSafe")(a);try{a.message=g}catch(b){h=c("err")(g,a.fileName,a.lineNumber)}f!==0&&(h.framesToPop=f);(a=j())==null||(f=a.addMetadata("MESSENGER_E2EE_WEB","APP_VERSION",d("MAWAppVersion").getVersionNumber()).tags(b.map(function(a){return String(a)})).catching(h)).mustfix.apply(f,[g].concat(e))});return s.apply(this,arguments)}var t={count:function(a,b){d("MAWConsoleLogger").logToConsole("count",a,b)},debug:function(a,b){d("MAWConsoleLogger").logToConsole("log",a,b)},devConsole:function(a,b,c){for(var e=arguments.length,f=new Array(e>3?e-3:0),g=3;g<e;g++)f[g-3]=arguments[g];switch(a){case"COUNT":d("MAWConsoleLogger").logToConsole.apply(void 0,["count",b,c].concat(f));break;case"DEV":d("MAWConsoleLogger").logToConsole.apply(void 0,["log",b,c].concat(f));break;case"DEV_XMPP":d("MAWConsoleLogger").logToConsole.apply(void 0,["log",b,c].concat(f));break;case"LOG":d("MAWConsoleLogger").logToConsole.apply(void 0,["info",b,c].concat(f));break;case"WARN":d("MAWConsoleLogger").logToConsole.apply(void 0,["warn",b,c].concat(f));break;case"ERROR":d("MAWConsoleLogger").logToConsole.apply(void 0,["error",b,c].concat(f));break;case"CATCHING":d("MAWConsoleLogger").logToConsole.apply(void 0,["error",b,c].concat(f));break}},error:function(a,b,e){c("promiseDone")(r(a,b,e)),d("MAWConsoleLogger").logToConsole("error",a,b)},info:function(a,b){m(a,b),d("MAWConsoleLogger").logToConsole("info",a,b)},logRestricted:function(a,b){k(a,b),d("MAWConsoleLogger").logToConsole("log",a,b)},warn:function(a,b){n(a,b),d("MAWConsoleLogger").logToConsole("warn",a,b)}};function u(){return!d("MAWLoggingSwitches").removeLoggingFromBridge?(h||(h=b("Promise"))).resolve([]):d("MAWSaveLogToDisk").getEntriesFromDb()}function v(){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!d("MAWLoggingSwitches").removeLoggingFromBridge)return;yield d("MAWDeleteOldLogsFromDisk").clearLogs()});return w.apply(this,arguments)}function x(a){return new Date(typeof a==="string"?parseInt(a,10):a).toISOString().replace("T"," ").replace("Z","")}function y(a){return a.map(function(a){try{var b=x(a.date);return[b,a.level,a.category,a.event,a.args].join(" | ")}catch(a){return[x(Date.now()),"error","LOGGER","Error formatting log: "+((a==null?void 0:a.message)||"")].join(" | ")}}).filter(Boolean).join("\n")}g.__testClearLoggerSetup=a;g.setupMainWaLogger=e;g.logRestricted=k;g.count=f;g.info=m;g.warn=n;g.logError=o;g.getEntries=u;g.clearEntries=v;g.formatEntries=y}),98);
__d("MWGetOtherContactOrSelf",["I64","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){a=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(c.tables.participants).getKeyRange(a)));if(a.length===1){var e=a[0];return d("ReQL").firstAsync(d("ReQL").fromTableAscending(c.tables.contacts).getKeyRange(e.contactId))}if(a.length>2)return;e=a.find(function(a){return!(h||(h=d("I64"))).equal(a.contactId,b)});if(e!=null)return d("ReQL").firstAsync(d("ReQL").fromTableAscending(c.tables.contacts).getKeyRange(e.contactId))});return i.apply(this,arguments)}g.getOtherContactOrSelf=a}),98);
__d("PromiseResult",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;a=function(){function a(){var a=this;this.promise=new(g||(g=b("Promise")))(function(b,c){a.$1=b,a.$2=c})}var c=a.prototype;c.resolve=function(a){this.$1(a)};c.reject=function(a){this.$2(a)};return a}();f["default"]=a}),66);
__d("MqttFetchClient",["MqttEnv","MqttProtocolCodec","MqttUserName","MqttUtils","Promise","PromiseResult"],(function(a,b,c,d,e,f,g){"use strict";var h,i="fetch_pull",j="fetch_pull_finish",k="fetch_",l=6e4,m="action",n="chunked",o="send",p="true",q=5,r=20,s=10,t=5e3,u=typeof window!=="undefined"?window:self;a=function(){function a(){this.$1="",this.$2=d("MqttEnv").Env.getLoggerInstance(),this.$3=0,this.$4="",this.$5=new(c("MqttUserName"))("",0,1,"",0,!0),this.$6=function(){},this.$7=function(a){},this.$8=function(){},this.$9=function(a){},this.$10=0,this.$11=0,this.$12=0,this.$13=0,this.$14="Ready",this.$15=[],this.$16=[],this.$17=null,this.$18=!1,this.$19=0}a.isSupported=function(){return typeof u.fetch==="function"};var e=a.prototype;e.run=function(a,b,c,e,f,g,h,i){var j=this;this.$1=d("MqttUtils").endpointWithSessionId(a,b);this.$3=b;this.$4=c;this.$5=e;this.$6=f;this.$7=g;this.$8=h;this.$9=i;d("MqttEnv").Env.setTimeout(function(){return j.$20()},0)};e.isTopicSupported=function(a){return!0};e.publish=function(a,b){return this.$21(a,b)};e.publishBinary=function(a,b){return this.$21(a,b)};e.$21=function(a,d){if(this.$14!=="ReceivingData"){this.$2.bumpCounter(k+"publish."+a+".invalidstate");return(h||(h=b("Promise"))).reject("not connected")}else{this.$2.bumpCounter(k+"publish."+a+".publish");var e=new(c("PromiseResult"))();a={topic:a,payload:d,promiseResult:e};this.$15.push(a);this.$22();return e.promise}};e.abort=function(){this.$6=function(){},this.$7=function(a){},this.$8=function(){},this.$9=function(a){}};e.$23=function(a){var b=this;a.forEach(function(a){b.$2.bumpCounter(k+"publish."+a.topic+".resolved"),a.promiseResult.resolve()});this.$12+=a.length};e.$24=function(a,b){var c=this;a.forEach(function(a){c.$2.bumpCounter(k+"publish."+a.topic+".rejected"),a.promiseResult.reject(b)})};e.$25=function(a,b,c,d){var e=a.map(function(a){return a.topic}).join(",");this.$2.debugTrace("FetchClient","Fetch publish request failed. Publishes:"+e+", retry:"+c);this.$2.bumpCounter(k+"publish_request_failed");this.$14!=="ReceivingData"||c===q?(this.$24(a,d),this.$18=!1,this.$2.bumpCounter(k+"publish_request_failed_final"),this.$22()):this.$26(a,b,c+1)};e.$27=function(a,b,c,d){if(!d.ok){this.$2.bumpCounter(k+"publish_request_failed.http."+d.status);if(d.status===409){this.$19++;if(this.$19>=s){this.$2.bumpCounter(k+"409_reset");this.$28(new Error("Too many 409 errors"));return}}this.$25(a,b,c,this.$29(d));return}this.$2.bumpCounter(k+"publish_request_success");b=a.map(function(a){return a.topic}).join(",");this.$2.debugTrace("FetchClient","Fetch publish request success. Publishes:"+b+", retry:"+c);this.$23(a);this.$18=!1;this.$22()};e.$22=function(){if(this.$14!=="ReceivingData")return;if(this.$18)return;if(this.$15.length===0&&this.$16.length===0)return;this.$18=!0;var a=this.$15.slice(0,r);this.$15=this.$15.slice(r,this.$15.length);this.$17!=null&&d("MqttEnv").Env.clearTimeout(this.$17);this.$17=null;var b=this.$16.slice(0,r);this.$16=this.$16.slice(r,this.$16.length);this.$26(a,b,0)};e.$26=function(a,b,c){var e=this,f=a.map(function(a){return a.topic}).join(",");this.$2.debugTrace("FetchClient","Fetch publish request sent. Publishes:"+f+", retry:"+c);f=d("MqttUtils").endpointWithExtraParameter(this.$1,m,o);var g=a.map(function(a){return{topic:a.topic,payload:a.payload,qos:0,messageId:d("MqttEnv").Env.random()}});g=this.$5.gen(this.$3,[],g,b);this.$2.bumpCounter(k+"publish_request");d("MqttUtils").promiseDoneWithTimeout(u.fetch(f,{method:"POST",mode:"cors",cache:"no-cache",credentials:"include",referrer:"no-referrer",body:g,keepalive:!1}),function(d){return e.$27(a,b,c,d)},function(d){return e.$25(a,b,c,d)},l)};e.$30=function(a){a=a.message;this.$2.debugTrace("FetchClient","Fetch request failed with error:"+a);this.$9(a);this.$31(!1,a);this.$2.bumpCounter(k+"error");this.$14="Error"};e.$32=function(a){var b=this;this.$2.debugTrace("FetchClient","Fetch response data received");a=d("MqttProtocolCodec").decodeByteMessages(new Uint8Array(a));a=a.messages;var c=a.filter(function(a){return a.messageType===d("MqttProtocolCodec").MESSAGE_TYPE.PINGREQ});a=a.filter(function(a){return a.messageType===d("MqttProtocolCodec").MESSAGE_TYPE.PUBLISH}).map(function(a){if(!(a instanceof d("MqttProtocolCodec").WireMessage.Publish))return{};a=a;a.qos===1&&a.messageIdentifier!=null&&(b.$16.push(a.messageIdentifier),b.$17==null&&(b.$17=d("MqttEnv").Env.setTimeout(function(){b.$22()},t)));return{topic:a.topic,payload:a.payloadMessage,qos:a.qos}});for(var e of a){var f;this.$2.bumpCounter(k+"response_"+((f=e.topic)!=null?f:"void"))}a&&a.length>0&&(this.$13+=a.length,this.$7(a));c&&c.length>0&&this.$33()};e.$33=function(){this.$2.debugTrace("FetchClient","Got server ping request"),this.$2.bumpCounter(k+"ping")};e.$28=function(a){this.$2.debugTrace("FetchClient","Fetch request ended: "+a.toString()),this.$2.bumpCounter(k+"done"),this.$34(a.message),this.$8(),this.$14="Done"};e.$35=function(a,b,c){var e=this;if(c!=null)try{this.$32(c)}catch(a){this.$28(a);this.$2.bumpCounter(k+"dataDecodeException");return}if(b){this.$28(new Error("EOF"));return}d("MqttUtils").promiseDone(a.read(),function(c){var b=c.done;c=c.value;return e.$35(a,b,c)},function(a){return e.$28(a)})};e.$36=function(a){if(!a.ok){this.$2.bumpCounter(k+"error.http."+a.status);this.$30(this.$29(a));return}a=a.body;if(!a){this.$30(new Error("Empty body"));return}a=a.getReader();this.$6();this.$2.bumpCounter(k+"success");this.$31(!0,null);this.$11=Date.now();this.$14="ReceivingData";this.$2.debugTrace("FetchClient","Fetch request success");this.$35(a,!1,null)};e.$34=function(a){this.$2.eventLogPullFinish({pullEventName:j,sessionID:this.$3,duration:Date.now()-this.$11,errorMessage:a,publishReceived:this.$13,publishSent:this.$12})};e.$31=function(a,b){this.$2.eventLogPull({pullEventName:i,sessionID:this.$3,status:a,duration:Date.now()-this.$10,hostname:this.$1,errorMessage:b})};e.$20=function(){var a=this;if(this.$14!=="Ready")return;this.$2.debugTrace("FetchClient","Sending fetch request");this.$2.bumpCounter(k+"request");this.$10=Date.now();var b=d("MqttUtils").endpointWithExtraParameter(this.$1,n,p);d("MqttUtils").promiseDoneWithTimeout(u.fetch(b,{method:"POST",mode:"cors",cache:"no-cache",credentials:"include",referrer:"no-referrer",body:this.$4,keepalive:!1}),function(b){return a.$36(b)},function(b){return a.$30(b)},l)};e.$29=function(a){return new Error("Http error, status="+a.status)};return a}();g["default"]=a}),98);
__d("MqttLongPollingClient",["MqttEnv","MqttProtocolCodec","MqttUserName","Promise","XHRRequest","getCrossOriginTransport","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";var h,i=120*1e3,j="simple_pull",k="longpolling_";a=function(){function a(){this.$3="",this.$4=0,this.$2=d("MqttEnv").Env.getLoggerInstance(),this.$1="Ready",this.$5="",this.$6=new(c("MqttUserName"))("",0,1,"",0,!0),this.$7=function(){},this.$8=function(a){},this.$9=function(){},this.$10=function(a){},this.$11=0,this.$12=null,this.$13=new Set(["/t_ms","/messenger_sync_get_diffs","/messenger_sync_create_queue","/webrtc","/rtc_multi"])}var e=a.prototype;e.run=function(a,b,c,d,e,f,g,h){this.$3=a,this.$4=b,this.$5=c,this.$6=d,this.$7=e,this.$8=f,this.$9=g,this.$10=h,this.$14(this.$5)};e.isTopicSupported=function(a){return this.$13.has(a)};e.publish=function(a,c){return(h||(h=b("Promise"))).reject("not supported")};e.publishBinary=function(a,c){return(h||(h=b("Promise"))).reject("not supported")};e.abort=function(){this.$12!=null&&this.$12.abort("Disconnected")};e.$15=function(a,b){if(this.$1===a)return;this.$1=a;a==="Error"&&b!=null&&this.$10(b);this.$2.debugTrace("LongPollingClient","_changeStatus : "+a)};e.$16=function(a){if(this.$1!=="RequestSend")return;if(!a){this.$17("EmptyResponse",null);return}this.$7();this.$2.bumpCounter(k+"success");this.$18(!0,null);this.$15("ResponseReceived");a=d("MqttProtocolCodec").decodeByteMessages(new Uint8Array(a));a=a.messages.filter(function(a){return a instanceof d("MqttProtocolCodec").WireMessage.Publish}).map(function(a){if(a instanceof d("MqttProtocolCodec").WireMessage.Publish){a=a;return{topic:a.topic,payload:a.payloadMessage,qos:a.qos}}else return{}});this.$8(a);this.$9()};e.$17=function(a,b){b=b!=null?b.message:"null";this.$2.debugTrace("LongPollingClient Error","Poll failed with error:"+a+", errorMsg:"+b);this.$18(!1,a+":"+b);this.$2.bumpCounter(k+"error."+a);this.$15("Error",a)};e.$18=function(a,b){this.$2.eventLogPull({pullEventName:j,sessionID:this.$4,status:a,duration:Date.now()-this.$11,hostname:this.$3,errorMessage:b})};e.$14=function(a){var b=this;if(this.$1!=="Ready"||this.$12)return;this.$2.bumpCounter(k+"request");try{this.$11=Date.now(),this.$12=new(c("XHRRequest"))(this.$3).setResponseType("arraybuffer").setRawData(a).setTransportBuilder(c("getCrossOriginTransport").withCredentials).setResponseHandler(function(a){return b.$16(a)}).setNetworkFailureHandler(function(a){b.$17("Network",a)}).setErrorHandler(function(a){b.$17("Error",a)}).setAbortHandler(function(a){b.$17("Abort",null)}).setTimeoutHandler(function(){b.$17("Timeout",null)}).setTimeout(i).send(),this.$15("RequestSend")}catch(a){this.$17("Error",c("getErrorSafe")(a))}};return a}();g["default"]=a}),98);
__d("MqttLongPollingHookCollection",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1=new Set()}var b=a.prototype;b.addHook=function(a){this.$1.add(a)};b.removeHook=function(a){this.$1["delete"](a)};b.onPollRequestSent=function(){this.$1.forEach(function(a){a.onPollRequestSent()})};b.onPollRequestSuccess=function(){this.$1.forEach(function(a){a.onPollRequestSuccess()})};b.onPollResponse=function(a){this.$1.forEach(function(b){b.onPollResponse(a)})};b.onPollFinish=function(){this.$1.forEach(function(a){a.onPollFinish()})};b.onPollRequestFailed=function(a){this.$1.forEach(function(b){b.onPollRequestFailed(a)})};b.onPollShutdownAbort=function(){this.$1.forEach(function(a){a.onPollShutdownAbort()})};return a}();f["default"]=a}),66);
__d("exponentialBackoff",["MqttEnv"],(function(a,b,c,d,e,f,g){function a(a,b){b===void 0&&(b=null);var c=null,e=0;function f(){for(var f=arguments.length,g=new Array(f),h=0;h<f;h++)g[h]=arguments[h];var i=function(){a.apply(b,g)};if(c===null){var j=Math.max(0,Math.pow(2,Math.min(e,6))*(1e3+d("MqttEnv").Env.random()*100)-2e3);c=d("MqttEnv").Env.setTimeout(function(){i(),c=null},j)}e++}f.reset=function(){e=0,c!=null&&(d("MqttEnv").Env.clearTimeout(c),c=null)};f.isPending=function(){return c!=null};return f}g["default"]=a}),98);
__d("MqttLongPollingRunner",["MqttEnv","MqttFetchClient","MqttLongPollingClient","MqttLongPollingHookCollection","MqttTypes","MqttUtils","MqttWebSocketUtils","Promise","exponentialBackoff"],(function(a,b,c,d,e,f,g){"use strict";var h,i=4,j=1e3,k=3e3,l="mqtt_should_longpoll",m="last_lp",n="yes",o="no";a=function(){function a(a,b,e,f,g,h,i,j,k){var l=this;this.$23=function(){try{if(!l.$30())return;l.$5.debugTrace("LongPollingRunner","_startPollingIfNecessary called");var a=l.$31();l.$14=a;var b=l.$9(),c=l.$10();b=b.filter(function(b){return a.isTopicSupported(b)});c=c.filter(function(b){return a.isTopicSupported(b.topic)});if(b.length===0&&c.length===0){l.$5.debugTrace("LongPollingRunner","Poll skipped, nothing to do");l.$14=null;d("MqttEnv").Env.setTimeout(function(){l.$23()},1e3);return}var e=d("MqttUtils").generateSessionId();a.run(l.$6,e,l.$7.gen(e,b,c),l.$7,function(){return l.$32()},function(a){return l.$33(a)},function(){return l.$34()},function(a){return l.$35(a)});l.$19.onPollRequestSent();e=b.join(",");b=c.map(function(a){return a.topic}).join(",");l.$5.debugTrace("LongPollingRunner","Making a poll request to "+l.$6+". SubscribedTopics:"+e+". Publishes:"+b)}catch(a){a&&l.$5.logErrorWarn(a,"lp_js_error"),l.$11(new(d("MqttTypes").MqttChannelError)(!1,"js error lp",a)),l.$35("lp_js_error")}};this.$6=a;this.$7=b;this.$1=f;this.$2=0;this.$3=e;this.$4=d("MqttWebSocketUtils").hasWSSupport();this.$5=d("MqttEnv").Env.getLoggerInstance();this.$8=g;this.$9=h;this.$10=i;this.$11=j;this.$12=k;this.$13=!1;this.$14=null;this.$15="LPInactive";this.$16="NotSent";this.$17=0;this.$19=new(c("MqttLongPollingHookCollection"))();this.$18=c("exponentialBackoff")(this.$23,this);this.$20=0;this.$21=o;a=d("MqttEnv").Env.genGk(d("MqttEnv").MqttGkNames.mqtt_lp_use_fetch);b=c("MqttFetchClient").isSupported();a?this.$5.bumpCounter("fetch_gk_pass"):this.$5.bumpCounter("fetch_gk_fail");b?this.$5.bumpCounter("fetch_api_supported"):this.$5.bumpCounter("fetch_api_not_supported");this.$22=a&&b}var e=a.prototype;e.addHook=function(a){this.$19.addHook(a)};e.start=function(){var a=this;this.$21=d("MqttEnv").Env.configRead(m,o);this.$5.debugTrace("LongPollingRunner","Runner loaded, last status "+this.$21);this.$20=Date.now();this.$23();d("MqttEnv").Env.setTimeout(function(){a.$23()},j+100);d("MqttEnv").Env.setTimeout(function(){a.$23()},k+100)};e.shutdown=function(){this.$5.debugTrace("LongPollingRunner","Shutdown called"),this.$14&&this.$14.abort(),this.$19.onPollShutdownAbort(),this.$14=null};e.canPublish=function(){return this.$15==="LPActive"&&this.$16==="ReceivingData"};e.publish=function(a,b,c){return this.$24(a,b)};e.publishBinary=function(a,b,c){return this.$24(a,b)};e.$24=function(a,c){if(d("MqttEnv").Env.genGk(d("MqttEnv").MqttGkNames.mqtt_enable_publish_over_polling)&&(this.$14&&this.$14.isTopicSupported(a)))if(typeof c==="string")return this.$14.publish(a,c);else return this.$14.publishBinary(a,c);return(h||(h=b("Promise"))).reject()};e.onConnectAttempt=function(){};e.onConnectFailure=function(){this.$2++,this.$23()};e.onConnected=function(){};e.onConnectSuccess=function(){this.$1=!0,d("MqttEnv").Env.configWrite(m,null)};e.onConnectionLost=function(){};e.onConnectionDisconnect=function(){};e.onSubscribe=function(a){};e.onUnsubscribe=function(a){};e.onPublish=function(a){};e.onMessage=function(a){};e.onWSFatal=function(){this.$3=!0,this.$23()};e.getStatus=function(){return this.$15};e.getRequestStatus=function(){return this.$16};e.$25=function(a){a!==this.$15&&(this.$5.debugTrace("LongPollingRunner","status changed to "+a+" from "+this.$15),this.$15=a,this.$12(this.$15,this.$16))};e.$26=function(a){if(!this.$22)return;a!==this.$16&&(this.$5.debugTrace("LongPollingRunner","request status changed to "+a+" from "+this.$16),this.$16=a,this.$12(this.$15,this.$16))};e.$27=function(){this.$17=0};e.$28=function(){this.$17++,this.$17>=i&&this.$25("LPError")};e.$29=function(){var a,b=(a=d("MqttEnv")).Env.genGk(a.MqttGkNames.mqtt_lp_no_delay),c=a.Env.genGk(a.MqttGkNames.mqtt_ws_polling_enabled);a=a.Env.genGk(a.MqttGkNames.mqtt_fast_lp);this.$5.debugTrace("LongPollingRunner","_shouldPoll? pollNow:"+String(b)+" enabled:"+String(c)+" fastPoll:"+String(a)+" hasWSSupport:"+String(this.$4)+" hasWsSuccessBefore:"+String(this.$1)+" failureCount:"+this.$2+" wsFatal:"+String(this.$3));if(!c)return!1;if(b){this.$5.bumpCounter(l+".nd");return!0}if(!this.$4){this.$5.bumpCounter(l+".na");return!0}if(this.$3){this.$5.bumpCounter(l+".fatal");return!0}if(this.$1)return!1;if(a){c=Date.now()-this.$20;if(this.$21===n){if(this.$2>=1)return!0;if(c>j){this.$5.bumpCounter(l+".fastdelay");return!0}}else if(c>k){this.$5.bumpCounter(l+".regulardelay");return!0}}if(this.$2>=3){this.$5.bumpCounter(l+".failure");return!0}return!1};e.$30=function(){if(this.$14!=null)return!1;var a=this.$29();!this.$13&&a&&(this.$5.bumpCounter("polling_kickin"),this.$13=!0,this.$25("LPActive"),this.$27());this.$13&&!a&&(this.$5.bumpCounter("polling_stopped"),this.$13=!1,this.$25("LPInactive"),this.$27());return a};e.$31=function(){if(this.$22){this.$5.debugTrace("LongPollingRunner","Creating polling client using Fetch API");return new(c("MqttFetchClient"))()}else{this.$5.debugTrace("LongPollingRunner","Creating regular Polling client");return new(c("MqttLongPollingClient"))()}};e.$32=function(){this.$5.debugTrace("LongPollingRunner","Poll success"),this.$19.onPollRequestSuccess(),this.$18.reset(),this.$25("LPActive"),this.$27(),d("MqttEnv").Env.configWrite(m,n),this.$26("ReceivingData")};e.$33=function(a){var b=a.map(function(a){return a.topic}).join(",");this.$5.debugTrace("LongPollingRunner","Poll response received, message received:"+b);for(b of a)this.$19.onPollResponse(b.topic),this.$8(b.topic,b.payload,b.qos)};e.$34=function(){this.$5.debugTrace("LongPollingRunner","Poll finish"),this.$19.onPollFinish(),this.$14&&this.$14.abort(),this.$14=null,this.$23(),this.$26("NotSent")};e.$35=function(a){this.$19.onPollRequestFailed(a),this.$14&&this.$14.abort(),this.$14=null,this.$18(),this.$28(),this.$26("NotSent")};return a}();g["default"]=a}),98);
__d("hasDefaultThreadOneToOneCapability",["FBLogger","LSContactBitOffset","MAWDefaultE2eeOneToOneEligibility","MWGetOtherContactOrSelf","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(a==null)return!1;var e=(yield d("ReQL").firstExnAsync(d("ReQL").fromTableAscending(b.tables._user_info).map(function(a){return a.facebookUserId}))),f=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.tables.contacts).getKeyRange(e)));if(f==null){c("FBLogger")("messenger_search").warn("Error fetching viewer details");return!1}f=d("LSContactBitOffset").has(80,f);if(!f)return!1;f=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.tables.contacts).getKeyRange(a)));a=(yield d("MWGetOtherContactOrSelf").getOtherContactOrSelf(a,e,b));e=a!=null?a:f;return d("MAWDefaultE2eeOneToOneEligibility").isContactDefaultE2eeOneToOneEligible({maybeContact:e})});return h.apply(this,arguments)}g["default"]=a}),98);
/**
 * License: https://www.facebook.com/legal/license/ZMc_bSwzLKC/
 */
__d("ristretto255-0.1.1",["tweetnacl-1.0.3"],(function(a,b,c,d,e,f,g){var h=c("tweetnacl-1.0.3")();Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:function(a,b){return new Uint8Array(Array.prototype.slice.call(this,a,b))}});c={};var i=h.lowlevel,j=i.gf([1]);function k(){return[i.gf(),i.gf(),i.gf(),i.gf()]}var l=new Uint8Array([226,242,174,10,106,188,78,113,168,132,169,97,197,0,81,95,88,227,11,106,165,130,221,141,182,166,89,69,224,141,45,118]),m=new Float64Array([235,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function n(a,b,c){var d=new Float64Array(64);for(var e=0;e<32;e++)for(var f=0;f<32;f++)d[e+f]+=b[e]*c[f];i.modL(a,d)}function o(a,b){n(a,b,b)}function p(a,b){for(var c=0;c<32;c++)a[c]=b[c];for(c=251;c>=0;c--)o(a,a),(m[c>>3]>>(c&7)&1)!==0&&n(a,a,b)}var q=i.gf([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]),r=i.gf([11803,18811,63136,32407,21693,7032,36364,44957,53757,12789,64713,3900,18604,11139,12735,14185]),s=i.gf([16618,32861,64938,39368,29374,23105,5655,40239,55360,65025,31633,5826,64674,53167,35077,30828]),t=i.gf([49526,37983,2497,57980,13583,52574,41272,11393,57316,48752,43997,39316,57559,45747,29352,656]),u=i.gf([19744,17645,23210,12717,6553,45086,18988,53918,20203,21147,54063,19676,8769,63084,45946,22888]);function v(a){var b=new Uint8Array(32);i.pack25519(b,a);a=1;for(var c=0;c<32;c++)a&=b[c]===0;return a}function w(a,b,c){var d;c=-c;for(var e=0;e<16;e++)d=a[e]^b[e],d&=c,a[e]^=d}function x(a){var b=new Uint8Array(32);i.pack25519(b,a);return b[0]&1}function y(a,b){i.Z(a,i.gf(),b)}function z(a,b,c){var d=i.gf();y(d,b);i.set25519(a,b);w(a,d,c)}function A(a,b){z(a,b,x(b))}function B(a,b,c){var d=i.gf(),e=i.gf(),f=i.gf(),g=i.gf(),h=i.gf(),j=i.gf();i.S(d,c);i.M(d,d,c);i.S(a,d);i.M(a,a,c);i.M(a,a,b);i.pow2523(a,a);i.M(a,a,d);i.M(a,a,b);i.S(e,a);i.M(e,e,c);i.Z(f,e,b);i.A(g,e,b);i.M(h,b,q);i.A(h,e,h);d=v(f);c=v(g);b=v(h);i.M(j,a,q);w(a,j,c|b);A(a,a);return d|c}function C(a){var b=i.gf(),c=i.gf(),d=i.gf(),e=i.gf(),f=i.gf(),g=i.gf(),h=i.gf(),k=i.gf(),l=i.gf(),m=i.gf(),n=i.gf(),o=i.gf(),p=i.gf(),r=i.gf(),t=i.gf(),u=i.gf(),v=i.gf(),y=0,C=new Uint8Array(32);i.A(m,a[2],a[1]);i.Z(v,a[2],a[1]);i.M(m,m,v);i.M(n,a[0],a[1]);i.S(o,n);i.M(o,m,o);B(f,j,o);i.M(b,f,m);i.M(c,f,n);i.M(u,b,c);i.M(u,u,a[3]);i.M(g,a[0],q);i.M(h,a[1],q);i.M(e,b,s);i.M(l,a[3],u);y=x(l);p=i.gf(a[0]);r=i.gf(a[1]);d=i.gf(c);w(p,h,y);w(r,g,y);w(d,e,y);i.M(t,p,u);z(r,r,x(t));i.Z(k,a[2],r);i.M(k,d,k);A(k,k);i.pack25519(C,k);return C}function D(a){var b=a[31]&127^127;for(var c=30;c>0;c--)b|=a[c]^255;b=(b|0>>>0)-1>>8;c=237-1-(a[0]|0>>>0)>>8;return 1-((b&c|a[0])&1|(a[31]&255)>>7)}function E(a,b){var c=i.gf(),d=i.gf(),e=i.gf(),f=i.gf(),g=i.gf(),h=i.gf(),k=i.gf(),l=i.gf(),m=i.gf(),n=i.gf();if(D(b)===0)return-1;i.unpack25519(e,b);i.S(f,e);i.set25519(g,j);i.Z(g,g,f);i.S(k,g);i.set25519(h,j);i.A(h,h,f);i.S(l,h);i.M(m,i.D,k);y(m,m);i.Z(m,m,l);i.M(n,m,l);i.set25519(d,j);b=B(c,d,n);i.M(a[0],c,h);i.M(a[1],c,a[0]);i.M(a[1],a[1],m);i.M(a[0],a[0],e);i.A(a[0],a[0],a[0]);A(a[0],a[0]);i.M(a[1],g,a[1]);i.set25519(a[2],j);i.M(a[3],a[0],a[1]);return-(1-b|x(a[3])|v(a[1]))}function F(a,b){var c=i.gf(),d=i.gf(),e=i.gf(),f=i.gf(),g=i.gf(),h=i.gf(),k=i.gf(),l=i.gf(),m=i.gf(),n=i.gf(),o=i.gf(),p=i.gf(),s=i.gf(),v=i.gf();i.set25519(e,j);i.S(f,b);i.M(f,q,f);i.A(m,f,e);i.M(m,m,t);i.set25519(c,j);y(c,c);i.A(g,f,i.D);i.M(n,f,i.D);i.Z(n,c,n);i.M(n,n,g);g=1-B(h,m,n);i.M(k,h,b);A(k,k);y(k,k);w(h,k,g);w(c,f,g);i.Z(d,f,e);i.M(d,d,c);i.M(d,d,u);i.Z(d,d,n);i.A(o,h,h);i.M(o,o,n);i.M(p,d,r);i.S(l,h);i.Z(s,e,l);i.A(v,e,l);i.M(a[0],o,v);i.M(a[1],s,p);i.M(a[2],p,v);i.M(a[3],o,s)}function G(a){var b=i.gf(),c=i.gf(),d=k(),e=k();i.unpack25519(b,a.slice(0,32));i.unpack25519(c,a.slice(32,64));F(d,b);F(e,c);i.add(d,e);return d}function a(a){var b=k();i.scalarbase(b,a);return C(b)}function b(a,b){var c=k(),d=k();if(E(c,b)!==0)throw new Error("Invalid argument");i.scalarmult(d,c,a);return C(d)}function d(a){var b=k();return E(b,a)===-1?!1:!0}function H(a,b){var c=k(),d=k();if(E(c,a)===-1)throw new Error("Invalid argument");if(E(d,b)===-1)throw new Error("Invalid argument");return[c,d]}function e(a,b){a=H(a,b);b=a[0];a=a[1];i.add(b,a);return C(b)}function I(a,b){var c=i.gf();y(c,b[3]);var d=i.gf();y(d,b[0]);d=[d,b[1],b[2],c];i.add(a,d)}function g(a,b){a=H(a,b);b=a[0];a=a[1];I(b,a);return C(b)}function J(){var a=h.randomBytes(64);return G(a)}function K(a){return C(G(a))}function L(){return C(J())}function M(){var a;new Uint8Array(32);var b=0;do{a=h.randomBytes(32);a[31]&=31;var c=32,d=1;do c--,b|=a[c]-i.L[c]>>8&d,d&=(a[c]^i.L[c])-1>>8;while(c!==0)}while(b===0);return a}function N(a){var b=new Uint8Array(32);p(b,a);return b}function O(a){var b=new Float64Array(64);for(var c=0;c<32;c++)b[c]=-a[c];c=new Uint8Array(32);i.modL(c,b);return c}function P(a,b){var c=new Float64Array(64);for(var d=0;d<32;d++)c[d]=a[d]+b[d];d=new Uint8Array(32);i.modL(d,c);return d}function Q(a,b){return P(a,O(b))}function R(a,b){var c=new Uint8Array(32);n(c,a,b);return c}c.scalarMultBase=a;c.scalarMult=b;c.isValid=d;c.add=e;c.sub=g;c.fromHash=K;c.getRandom=L;c.basePoint=l;c.scalar={};c.scalar.getRandom=M;c.scalar.invert=N;c.scalar.negate=O;c.scalar.add=P;c.scalar.sub=Q;c.scalar.mul=R;c.unsafe={};c.unsafe.point={};c.unsafe.point.toBytes=C;c.unsafe.point.fromBytes=E;c.unsafe.point.fromHash=G;c.unsafe.point.sub=I;c.unsafe.point.add=i.add;c.unsafe.point.scalarMultBase=i.scalarbase;c.unsafe.point.scalarMult=i.scalarmult;c.unsafe.point.getRandom=J;c.unsafe.point.alloc=k;c.unsafe.constants={};c.unsafe.constants.LSub2=m;c.unsafe.constants.sqrtm1=q;c.unsafe.constants.sqrtadm1=r;c.unsafe.constants.invsqrtamd=s;c.unsafe.constants.onemsqd=t;c.unsafe.constants.sqdmone=u;f.exports=c}),34);
__d("ristretto255",["ristretto255-0.1.1"],(function(a,b,c,d,e,f){e.exports=b("ristretto255-0.1.1")}),null);